# Makefile para automaÃ§Ã£o de comandos do JARVIS
# Este arquivo simplifica operaÃ§Ãµes comuns do sistema

.PHONY: help setup up down logs status clean rebuild test lint format debug install

# ConfiguraÃ§Ãµes
DOCKER_COMPOSE = docker-compose
PYTHON = python3
PIP = pip3

# Cores para output (compatÃ­vel com macOS)
GREEN = \033[0;32m
YELLOW = \033[0;33m
RED = \033[0;31m
NC = \033[0m # No Color

help: ## ğŸ“– Mostra esta ajuda
	@echo "$(GREEN)ğŸ¤– JARVIS - Sistema Multi-Agente$(NC)"
	@echo "$(YELLOW)Comandos disponÃ­veis:$(NC)"
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "  $(GREEN)%-15s$(NC) %s\n", $$1, $$2}' $(MAKEFILE_LIST)

setup: ## ğŸš€ ConfiguraÃ§Ã£o inicial completa
	@echo "$(GREEN)Iniciando configuraÃ§Ã£o do JARVIS...$(NC)"
	@$(PYTHON) -m venv venv || echo "$(YELLOW)Ambiente virtual jÃ¡ existe$(NC)"
	@source venv/bin/activate && $(PIP) install --upgrade pip
	@source venv/bin/activate && $(PIP) install -r requirements.txt
	@mkdir -p logs data/photos memory/data
	@$(DOCKER_COMPOSE) build
	@echo "$(GREEN)âœ… ConfiguraÃ§Ã£o concluÃ­da!$(NC)"
	@echo "$(YELLOW)Execute 'make up' para iniciar o sistema$(NC)"

install: ## ğŸ“¦ Instala dependÃªncias Python
	@echo "$(GREEN)Instalando dependÃªncias...$(NC)"
	@$(PIP) install -r requirements.txt
	@echo "$(GREEN)âœ… DependÃªncias instaladas!$(NC)"

up: ## â–¶ï¸ Inicia todos os serviÃ§os
	@echo "$(GREEN)Iniciando JARVIS...$(NC)"
	@$(DOCKER_COMPOSE) up -d
	@echo "$(GREEN)âœ… JARVIS estÃ¡ rodando!$(NC)"
	@echo "$(YELLOW)RabbitMQ Management: http://localhost:15672 (guest/guest)$(NC)"
	@echo "$(YELLOW)Use 'make logs' para ver os logs$(NC)"

down: ## â¹ï¸ Para todos os serviÃ§os
	@echo "$(YELLOW)Parando JARVIS...$(NC)"
	@$(DOCKER_COMPOSE) down
	@echo "$(GREEN)âœ… JARVIS parado$(NC)"

logs: ## ğŸ“„ Mostra logs de todos os serviÃ§os
	@$(DOCKER_COMPOSE) logs --tail=100

logs-follow: ## ğŸ“„ Mostra logs em tempo real
	@$(DOCKER_COMPOSE) logs -f

logs-photo: ## ğŸ“¸ Logs do PhotoAgent
	@$(DOCKER_COMPOSE) logs photo-agent --tail=50

logs-marketing: ## ğŸ“ˆ Logs do MarketingAgent
	@$(DOCKER_COMPOSE) logs marketing-agent --tail=50

logs-social: ## ğŸ“± Logs do SocialMediaAgent
	@$(DOCKER_COMPOSE) logs social-media-agent --tail=50

logs-crm: ## ğŸ‘¥ Logs do CRMAgent
	@$(DOCKER_COMPOSE) logs crm-agent --tail=50

logs-calendar: ## ğŸ“… Logs do CalendarAgent
	@$(DOCKER_COMPOSE) logs calendar-agent --tail=50

logs-finance: ## ğŸ’° Logs do FinanceAgent
	@$(DOCKER_COMPOSE) logs finance-agent --tail=50

logs-task: ## âœ… Logs do TaskAgent
	@$(DOCKER_COMPOSE) logs task-agent --tail=50

logs-orchestrator: ## ğŸ­ Logs do Orchestrator
	@$(DOCKER_COMPOSE) logs orchestrator --tail=50

logs-rabbitmq: ## ğŸ° Logs do RabbitMQ
	@$(DOCKER_COMPOSE) logs rabbitmq --tail=50

status: ## ğŸ“Š Status de todos os serviÃ§os
	@echo "$(GREEN)Status dos serviÃ§os JARVIS:$(NC)"
	@$(DOCKER_COMPOSE) ps

clean: ## ğŸ§¹ Limpa containers, imagens e volumes
	@echo "$(YELLOW)Limpando containers e volumes...$(NC)"
	@$(DOCKER_COMPOSE) down -v
	@docker system prune -f
	@echo "$(GREEN)âœ… Limpeza concluÃ­da$(NC)"

rebuild: ## ğŸ”„ ReconstrÃ³i todas as imagens
	@echo "$(GREEN)Reconstruindo imagens...$(NC)"
	@$(DOCKER_COMPOSE) build --no-cache
	@echo "$(GREEN)âœ… Imagens reconstruÃ­das$(NC)"

restart: ## ğŸ”„ Reinicia todos os serviÃ§os
	@echo "$(YELLOW)Reiniciando JARVIS...$(NC)"
	@$(DOCKER_COMPOSE) restart
	@echo "$(GREEN)âœ… JARVIS reiniciado$(NC)"

test: ## ğŸ§ª Executa testes
	@echo "$(GREEN)Executando testes...$(NC)"
	@source venv/bin/activate && pytest tests/ -v
	@echo "$(GREEN)âœ… Testes concluÃ­dos$(NC)"

lint: ## ğŸ” Verifica qualidade do cÃ³digo
	@echo "$(GREEN)Verificando cÃ³digo...$(NC)"
	@source venv/bin/activate && flake8 agents/ orchestrator/ cli/ memory/
	@source venv/bin/activate && mypy agents/ orchestrator/ cli/ memory/ --ignore-missing-imports
	@echo "$(GREEN)âœ… VerificaÃ§Ã£o concluÃ­da$(NC)"

format: ## ğŸ¨ Formata cÃ³digo automaticamente
	@echo "$(GREEN)Formatando cÃ³digo...$(NC)"
	@source venv/bin/activate && black agents/ orchestrator/ cli/ memory/ examples/
	@echo "$(GREEN)âœ… CÃ³digo formatado$(NC)"

# Comandos de debug individuais
debug-photo: ## ğŸ› Debug PhotoAgent
	@$(DOCKER_COMPOSE) run --rm photo-agent python -c "import agent; print('PhotoAgent OK')"

debug-marketing: ## ğŸ› Debug MarketingAgent
	@$(DOCKER_COMPOSE) run --rm marketing-agent python -c "import agent; print('MarketingAgent OK')"

debug-rabbitmq: ## ğŸ› Testa conexÃ£o RabbitMQ
	@$(DOCKER_COMPOSE) exec rabbitmq rabbitmqctl status

# Comandos de CLI
cli: ## ğŸ’» Abre CLI interativo
	@source venv/bin/activate && python cli/jarvis_cli.py

cli-task: ## ğŸ’» Executa tarefa via CLI (uso: make cli-task TASK="sua tarefa")
	@source venv/bin/activate && python cli/jarvis_cli.py task "$(TASK)"

# Exemplos
example-communication: ## ğŸ”„ Testa comunicaÃ§Ã£o entre agentes
	@echo "$(GREEN)Executando exemplo de comunicaÃ§Ã£o...$(NC)"
	@source venv/bin/activate && python examples/agent_communication_demo.py

example-simple: ## ğŸš€ Executa exemplo simples
	@echo "$(GREEN)Executando exemplo simples...$(NC)"
	@source venv/bin/activate && python examples/simple_task.py

# UtilitÃ¡rios
check-deps: ## âœ… Verifica dependÃªncias do sistema
	@echo "$(GREEN)Verificando dependÃªncias...$(NC)"
	@echo "Python: $$(python3 --version)"
	@echo "Docker: $$(docker --version)"
	@echo "Docker Compose: $$(docker-compose --version)"
	@echo "$(GREEN)âœ… DependÃªncias verificadas$(NC)"

backup-memory: ## ğŸ’¾ Backup do sistema de memÃ³ria
	@echo "$(GREEN)Fazendo backup da memÃ³ria...$(NC)"
	@tar -czf backup_memory_$$(date +%Y%m%d_%H%M%S).tar.gz memory/
	@echo "$(GREEN)âœ… Backup concluÃ­do$(NC)"

monitor: ## ğŸ“Š Monitora recursos dos containers
	@echo "$(GREEN)Monitorando recursos (Ctrl+C para sair)...$(NC)"
	@docker stats

# ConfiguraÃ§Ã£o de desenvolvimento
dev-setup: ## ğŸ› ï¸ ConfiguraÃ§Ã£o para desenvolvimento
	@echo "$(GREEN)Configurando ambiente de desenvolvimento...$(NC)"
	@$(PYTHON) -m venv venv
	@source venv/bin/activate && $(PIP) install -r requirements.txt
	@source venv/bin/activate && $(PIP) install pytest black flake8 mypy
	@echo "$(GREEN)âœ… Ambiente de desenvolvimento configurado$(NC)"

# Default target
.DEFAULT_GOAL := help